<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Blog - JarnoWiFi</title>
    <meta name="description" content="Field notes and deployment stories from JarnoWiFi." />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Work+Sans:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link href="/site.css" rel="stylesheet" />
    <script src="/menu.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-D6BR389F7B"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-D6BR389F7B');
    </script>

    <style>
      .page-shell {
        padding-top: 6.5rem;
        padding-bottom: 4rem;
      }

      .post-meta {
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        color: rgba(17, 24, 39, 0.6);
      }

      .tag-pill {
        background: rgba(27, 142, 166, 0.12);
        color: var(--teal);
        border-radius: 999px;
        padding: 0.25rem 0.75rem;
        font-weight: 600;
        font-size: 0.8rem;
      }

      .post-content p {
        margin-bottom: 1.5rem;
        line-height: 1.7;
      }

      .post-gallery img {
        object-fit: cover;
        border-radius: 1rem;
        border: 1px solid rgba(15, 23, 42, 0.08);
      }
    </style>
  </head>
  <body>
    <div data-include="header" data-active="blog"></div>

    <main class="page-shell">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-9">
            <div class="alert alert-info" role="status" data-post-status>Loading post...</div>

            <article class="d-none" data-post-article>
              <p class="section-label mb-2">Blog</p>
              <h1 class="fw-bold mb-3" data-post-title></h1>
              <div class="d-flex flex-wrap align-items-center gap-2 mb-4">
                <span class="post-meta" data-post-date></span>
                <div class="d-flex flex-wrap gap-2" data-post-tags></div>
              </div>
              <div class="ratio ratio-16x9 rounded-4 overflow-hidden shadow-sm mb-4 d-none" data-post-cover>
                <img class="w-100 h-100" alt="" loading="lazy" data-post-cover-img />
              </div>
              <div class="post-content text-muted" data-post-content></div>
              <div class="post-gallery row g-3 mt-4 d-none" data-post-gallery></div>
            </article>

            <div class="mt-5 d-none" data-post-list>
              <h4 class="fw-semibold mb-3">More posts</h4>
              <div class="row g-4" data-post-list-container></div>
              <div class="mt-5">
                <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-3">
                  <h4 class="fw-semibold mb-0">PD0DP feed</h4>
                  <a class="text-decoration-none" href="/blog/sources/pd0dp-feed.xml" target="_blank" rel="noopener">XML</a>
                </div>
                <div class="row g-4" data-feed-list></div>
                <p class="text-muted small mb-0 d-none" data-feed-status>Unable to load the feed right now.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer py-4">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6">
            <h5 class="fw-semibold">JarnoWiFi</h5>
            <p class="text-white-50 mb-0">Enterprise WiFi for events, powered by Starlink + 5G.</p>
          </div>
          <div class="col-md-6 text-md-end mt-3 mt-md-0">
            <a class="me-3" href="/#services">Services</a>
            <a class="me-3" href="/reliability">Reliability</a>
            <a class="me-3" href="/#pricing">Plans</a>
            <a class="me-3" href="/jobs">Jobs</a>
            <a class="me-3" href="/imprint">Imprint</a>
            <a href="/#contact">Contact</a>
          </div>
        </div>
      </div>
    </footer>

    <script>
      loadHeader({ active: "blog" }).then(() => {
      const homeLink = document.querySelector("[data-home-link]");
      const postStatus = document.querySelector("[data-post-status]");
      const postArticle = document.querySelector("[data-post-article]");
      const postTitle = document.querySelector("[data-post-title]");
      const postDate = document.querySelector("[data-post-date]");
      const postTags = document.querySelector("[data-post-tags]");
      const postCover = document.querySelector("[data-post-cover]");
      const postCoverImg = document.querySelector("[data-post-cover-img]");
      const postContent = document.querySelector("[data-post-content]");
      const postGallery = document.querySelector("[data-post-gallery]");
      const postList = document.querySelector("[data-post-list]");
      const postListContainer = document.querySelector("[data-post-list-container]");
      const feedList = document.querySelector("[data-feed-list]");
      const feedStatus = document.querySelector("[data-feed-status]");

      function formatDate(dateString) {
        if (!dateString) {
          return "";
        }
        const date = new Date(dateString);
        if (Number.isNaN(date.getTime())) {
          return dateString;
        }
        return date.toLocaleDateString("en-US", {
          year: "numeric",
          month: "short",
          day: "numeric"
        });
      }

      function setStatus(message, style) {
        if (!postStatus) {
          return;
        }
        postStatus.textContent = message;
        postStatus.classList.remove("alert-info", "alert-danger");
        postStatus.classList.add(style === "error" ? "alert-danger" : "alert-info");
      }

      function renderTags(tags) {
        if (!postTags) {
          return;
        }
        postTags.innerHTML = "";
        (tags || []).forEach((tag) => {
          const chip = document.createElement("span");
          chip.className = "tag-pill";
          chip.textContent = tag;
          postTags.appendChild(chip);
        });
      }

      function normalizeAssetPath(path) {
        if (!path) {
          return "";
        }
        if (path.startsWith("http://") || path.startsWith("https://") || path.startsWith("/")) {
          return path;
        }
        if (path.startsWith("./")) {
          return "/" + path.slice(2);
        }
        return "/" + path;
      }

      function renderContent(content) {
        if (!postContent) {
          return;
        }
        postContent.innerHTML = "";
        (content || []).forEach((paragraph) => {
          const p = document.createElement("p");
          p.textContent = paragraph;
          postContent.appendChild(p);
        });
      }

      function renderGallery(images) {
        if (!postGallery) {
          return;
        }
        postGallery.innerHTML = "";
        if (!Array.isArray(images) || images.length === 0) {
          postGallery.classList.add("d-none");
          return;
        }
        postGallery.classList.remove("d-none");
        images.forEach((image) => {
          const col = document.createElement("div");
          col.className = "col-6 col-md-4";
          const ratio = document.createElement("div");
          ratio.className = "ratio ratio-4x3";
          const img = document.createElement("img");
          img.className = "w-100 h-100";
          img.src = normalizeAssetPath(image);
          img.alt = "Blog image";
          img.loading = "lazy";
          img.classList.add('enlargeable');
          ratio.appendChild(img);
          col.appendChild(ratio);
          postGallery.appendChild(col);
        });
      }

      function createPostCard(post) {
        const col = document.createElement("div");
        col.className = "col-md-6";
        const card = document.createElement("article");
        card.className = "card blog-card h-100 position-relative";
        const linkTarget = post.id ? `/blog/${encodeURIComponent(post.id)}` : "";

        if (post.cover) {
          const ratio = document.createElement("div");
          ratio.className = "ratio ratio-16x9";
          const img = document.createElement("img");
          img.className = "w-100 h-100 blog-card__cover";
          img.src = normalizeAssetPath(post.cover);
          img.alt = post.title || "";
          img.loading = "lazy";
          ratio.appendChild(img);
          card.appendChild(ratio);
        }

        const body = document.createElement("div");
        body.className = "card-body d-flex flex-column";

        const meta = document.createElement("p");
        meta.className = "post-meta mb-2";
        meta.textContent = formatDate(post.date);
        body.appendChild(meta);

        if (linkTarget) {
          const titleLink = document.createElement("a");
          titleLink.className = "fw-semibold blog-link stretched-link";
          titleLink.textContent = post.title || "";
          titleLink.href = linkTarget;
          titleLink.setAttribute("aria-label", post.title || "Open post");
          body.appendChild(titleLink);
        }

        if (post.excerpt) {
          const excerpt = document.createElement("p");
          excerpt.className = "text-muted mt-2 mb-0";
          excerpt.textContent = post.excerpt;
          body.appendChild(excerpt);
        }

        card.appendChild(body);
        col.appendChild(card);
        return col;
      }

      function renderPostList(posts) {
        if (!postList || !postListContainer) {
          return;
        }
        postListContainer.innerHTML = "";
        posts.forEach((post) => {
          postListContainer.appendChild(createPostCard(post));
        });
        postList.classList.remove("d-none");
      }

      function stripHtml(html) {
        if (!html) {
          return "";
        }
        const temp = document.createElement("div");
        temp.innerHTML = html;
        return temp.textContent || "";
      }

      function createFeedCard(item) {
        const col = document.createElement("div");
        col.className = "col-md-6";
        const card = document.createElement("article");
        card.className = "card blog-card h-100 position-relative";

        const body = document.createElement("div");
        body.className = "card-body d-flex flex-column";

        const meta = document.createElement("p");
        meta.className = "post-meta mb-2";
        meta.textContent = formatDate(item.date);
        body.appendChild(meta);

        if (item.link) {
          const titleLink = document.createElement("a");
          titleLink.className = "fw-semibold blog-link stretched-link";
          titleLink.textContent = item.title || "";
          titleLink.href = item.link;
          titleLink.target = "_blank";
          titleLink.rel = "noopener";
          body.appendChild(titleLink);
        } else if (item.title) {
          const title = document.createElement("h5");
          title.className = "fw-semibold";
          title.textContent = item.title;
          body.appendChild(title);
        }

        if (item.excerpt) {
          const excerpt = document.createElement("p");
          excerpt.className = "text-muted mt-2 mb-0";
          excerpt.textContent = item.excerpt;
          body.appendChild(excerpt);
        }

        card.appendChild(body);
        col.appendChild(card);
        return col;
      }

      async function loadFeedPosts() {
        if (!feedList || !feedStatus) {
          return;
        }
        try {
          const response = await fetch("/blog/sources/pd0dp-feed.xml", { cache: "no-store" });
          if (!response.ok) {
            throw new Error("Feed request failed");
          }
          const xmlText = await response.text();
          const doc = new DOMParser().parseFromString(xmlText, "text/xml");
          const items = Array.from(doc.querySelectorAll("item")).slice(0, 6).map((item) => {
            const title = item.querySelector("title")?.textContent?.trim() || "";
            const link = item.querySelector("link")?.textContent?.trim() || "";
            const date = item.querySelector("pubDate")?.textContent?.trim() || "";
            const description = item.querySelector("description")?.textContent || "";
            const cleanText = stripHtml(description).replace(/\s+/g, " ").trim();
            const excerpt = cleanText.length > 180 ? `${cleanText.slice(0, 177).trim()}...` : cleanText;
            return { title, link, date, excerpt };
          }).filter((entry) => entry.title);

          feedList.innerHTML = "";
          if (items.length === 0) {
            feedStatus.textContent = "No feed posts found.";
            feedStatus.classList.remove("d-none");
            return;
          }

          items.forEach((entry) => {
            feedList.appendChild(createFeedCard(entry));
          });
          feedStatus.classList.add("d-none");
        } catch (error) {
          console.error("Feed load error:", error);
          feedStatus.textContent = "Unable to load the feed right now.";
          feedStatus.classList.remove("d-none");
        }
      }

      function setHomeLink() {
        if (!homeLink) {
          return;
        }
        const storedLang = localStorage.getItem("lang");
        const lang = storedLang || "nl";
        homeLink.setAttribute("href", `/?lang=${lang}#blog`);
      }

      function getPostId() {
        const params = new URLSearchParams(window.location.search);
        const queryId = params.get("id");
        if (queryId) {
          return queryId;
        }
        const path = window.location.pathname.replace(/\/+/g, "/");
        const parts = path.split("/").filter(Boolean);
        const blogIndex = parts.indexOf("blog");
        if (blogIndex === -1 || blogIndex === parts.length - 1) {
          return "";
        }
        return decodeURIComponent(parts[blogIndex + 1]);
      }

      async function loadPost() {
        const postId = getPostId();
        setHomeLink();

        try {
          const response = await fetch("/data/blog-posts.json", { cache: "no-store" });
          if (!response.ok) {
            throw new Error("Post data request failed");
          }
          const data = await response.json();
          const posts = Array.isArray(data.posts) ? data.posts : [];
          const post = posts.find((item) => item.id === postId);

          if (!postId) {
            setStatus("Select a post to read.", "info");
            renderPostList(posts);
            loadFeedPosts();
            return;
          }

          if (!post) {
            setStatus("Post not found. Browse other posts below.", "error");
            renderPostList(posts);
            loadFeedPosts();
            return;
          }

          if (postTitle) {
            postTitle.textContent = post.title || "";
          }
          if (postDate) {
            postDate.textContent = formatDate(post.date);
          }
          renderTags(post.tags || []);
          renderContent(post.content || []);
          renderGallery(post.images || []);

          if (postCover && postCoverImg && post.cover) {
            postCoverImg.src = normalizeAssetPath(post.cover);
            postCoverImg.alt = post.title || "";
            postCover.classList.remove("d-none");
            postCoverImg.classList.add('enlargeable');
          }

          if (postArticle) {
            postArticle.classList.remove("d-none");
          }

          if (postStatus) {
            postStatus.classList.add("d-none");
          }
        } catch (error) {
          console.error("Post load error:", error);
          setStatus("Unable to load this post. Please try again later.", "error");
        }
      }

      loadPost();

      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('enlargeable')) {
          const src = e.target.src;
          document.getElementById('modalImage').src = src;
          const modal = new bootstrap.Modal(document.getElementById('imageModal'));
          modal.show();
        }
      });
      });
    </script>

    <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-body p-0">
            <img id="modalImage" class="w-100" alt="Enlarged image">
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
